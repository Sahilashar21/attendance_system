{% extends "base.html" %}
{% block content %}

<h3 class="mb-3">Admin Dashboard</h3>

<!-- Add Intern + Manage Interns -->
<div class="d-flex gap-2 mb-4">
  <a href="{{ url_for('add_intern') }}" class="btn btn-success">+ Add New Intern</a>

  <!-- Dropdown Toggle -->
  <button class="btn btn-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#internDropdown">
    Manage Interns
  </button>
</div>

<!-- COLLAPSIBLE INTERN LIST -->
<div class="collapse" id="internDropdown">
  <div class="card card-body shadow-sm mb-4">
      <h5>Manage Interns</h5>

      <table class="table table-bordered table-sm mt-3">
        <thead class="table-dark">
          <tr>
            <th>Full Name</th>
            <th>Username</th>
            <th>Actions</th>
          </tr>
        </thead>

        <tbody>
          {% for i in interns %}
          <tr>
            <td>{{ i.full_name }}</td>
            <td>{{ i.username }}</td>
            <td class="d-flex gap-2">

              <!-- EDIT BUTTON -->
              <button class="btn btn-warning btn-sm"
                      type="button"
                      data-bs-toggle="collapse"
                      data-bs-target="#edit{{ i.username }}">
                Edit
              </button>

              <!-- DELETE BUTTON -->
              <form method="POST" action="{{ url_for('delete_intern') }}"
                    onsubmit="return confirm('Are you sure you want to delete this intern?');">
                <input type="hidden" name="username" value="{{ i.username }}">
                <button class="btn btn-danger btn-sm">Delete</button>
              </form>

            </td>
          </tr>

          <!-- COLLAPSIBLE EDIT FORM -->
          <tr class="collapse" id="edit{{ i.username }}">
            <td colspan="3">
              <div class="card card-body">

                <form method="POST" action="{{ url_for('update_intern') }}">

                  <input type="hidden" name="original_username" value="{{ i.username }}">

                  <div class="mb-2">
                    <label class="form-label">Full Name</label>
                    <input type="text" class="form-control" name="full_name" value="{{ i.full_name }}" required>
                  </div>

                  <div class="mb-2">
                    <label class="form-label">Username</label>
                    <input type="text" class="form-control" name="username" value="{{ i.username }}" required>
                  </div>

                  <div class="mb-2">
                    <label class="form-label">Password</label>
                    <input type="text" class="form-control" name="password" value="{{ i.password }}" required>
                  </div>

                  <button class="btn btn-primary btn-sm mt-2">Update</button>

                </form>

              </div>
            </td>
          </tr>

          {% endfor %}
        </tbody>
      </table>
  </div>
</div>

<hr>

<!-- DATE FILTER -->
<form method="POST" class="row g-2 mb-3">
  <div class="col-auto">
    <input type="date" class="form-control" name="date" value="{{ date }}">
  </div>
  <div class="col-auto">
    <button class="btn btn-primary">Filter</button>
  </div>
</form>

<!-- DOWNLOAD EXCEL -->
<form method="POST" action="{{ url_for('download_excel') }}" class="mb-3">
  <input type="hidden" name="date" value="{{ date }}">
  <button class="btn btn-success">Download Excel</button>
</form>

{% if records %}
<table class="table table-bordered table-striped">
  <thead class="table-dark">
    <tr>
      <th>Name</th>
      <th>Username</th>
      <th>Work Type</th>
      <th>Login Time</th>
      <th>Logout Time</th>
      <th>Hours Worked</th>
      <th>Status</th>
    </tr>
  </thead>

  <tbody>
    {% for r in records %}
    <tr class="{% if r.status == 'Present' %}table-success{% else %}table-danger{% endif %}">
      <td>{{ r.name }}</td>
      <td>{{ r.username }}</td>
      <td>{{ r.work_type }}</td>
      <td>{{ r.login_time }}</td>
      <td>{{ r.logout_time or "-" }}</td>
      <td>{{ r.hours_worked or "-" }}</td>

      <td>
        {% if r.status == "Present" %}
        <span class="badge bg-success">Present</span>
        {% else %}
        <span class="badge bg-danger">Absent</span>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

{% else %}
<p>No attendance records found.</p>
{% endif %}

{% endblock %}
